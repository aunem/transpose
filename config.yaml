apiVersion: alpha.aunem.com/v1
kind: Transpose
metadata:
  name: myProxy
  namespace: default
spec:
  debug: true
  localBuild: false

  listener:
    name: httplistener
    package: github.com/aunem/transpose-plugins/listener/http@poc
    spec: 
      port: 8080
      ssl: false

  middleware:
    request:
    - name: hydraAuth
      package: github.com/aunem/transpose-plugins/middleware/hydra@poc
      spec:
        endpoint: http://localhost:4444
        clientID: admin
        clientSecret: password
        scopes:
          - hydra
          - core
        resourceMap:
          - http:
              method: POST
              path: "/"
            action: create
            resource: "rn:myserver:root"
    response:
    - name: hydraAuth
      package: github.com/aunem/transpose-plugins/middleware/hydra@poc
      spec:
        endpoint: http://localhost:4444
        clientID: admin
        clientSecret: password
        scopes:
          - hydra
          - core

  roundtrip:
    name: muxRoundtrip
    package: github.com/aunem/transpose-plugins/roundtrip/supermux@poc
    spec:
      http:
      - path: "/"
        backend:
          serviceName: server
          servicePort: 80
